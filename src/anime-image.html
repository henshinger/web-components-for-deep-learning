<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="shared-styles.html"><script src="../lib/webdnn.js"></script></head><body><dom-module id="anime-image-uploader"><template><style include="shared-styles">:host{display:block;padding:10px;margin:auto;}paper-progress{display:block;width:100%;margin:20px 0;}paper-progress.pink{--paper-progress-active-color:var(--paper-pink-500);--paper-progress-secondary-color:var(--paper-pink-100);}#imageCanvas{margin-top:10px;display:block;height:224;width:224;}</style><template is="dom-if" if="{{!loaded}}"><paper-progress value="{{progress}}" class="pink"></paper-progress></template><template is="dom-if" if="{{loaded}}"><canvas id="imageCanvas" height="224" width="224"></canvas></template></template><script>var AnimeImage=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:async function(){var d=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this.runner=await WebDNN.load('../lib/output_keras',{progressCallback:function(g,h){return d.set('progress',100*g/h)}}),this.shadowRoot.addEventListener('loadImage',function(f){d.loadImage(f.detail.dataURL)})}},{key:'computeLoaded',value:function(d){return 100==d}},{key:'computeState',value:function(d,f,g){return g?'loading':d?d?0.5<f?'anime':'notAnime':void 0:'computing'}},{key:'computeIsAnime',value:function(d){return'anime'==d}},{key:'loadImage',value:async function(d){var f=d,g=await WebDNN.Image.getImageArray(f,{dstW:224,dstH:224});WebDNN.Image.setImageArrayToCanvas(g,224,224,this.shadowRoot.querySelector('#imageCanvas')),this.set('firstTime',!1),this.set('imageData',f),this.run()}},{key:'run',value:async function(){this.runner.getInputViews()[0].set((await WebDNN.Image.getImageArray(this.shadowRoot.querySelector('#imageCanvas'),{order:WebDNN.Image.Order.HWC,color:WebDNN.Image.Color.BGR,bias:[123.68,116.779,103.939]}))),this.set('finishedComputing',!1),this.set('animeProbability',0),await this.runner.run();var d=this.runner.getOutputViews()[0].toActual();this.set('animeProbability',d[0]),this.set('finishedComputing',!0)}}],[{key:'is',get:function(){return'anime-image'}},{key:'properties',get:function(){return{progress:{type:Number,value:0},imageData:{type:String,value:0},animeProbability:{type:Number,value:0},finishedComputing:{type:Boolean,value:!1},firstTime:{type:Boolean,value:!0},loaded:{type:Boolean,computed:'computeLoaded(progress)',notify:!0},state:{type:String,computed:'computeState(finishedComputing, animeProbability, firstTime)',notify:!0},isAnime:{type:Boolean,computed:'computeIsAnime(state)',notify:!0}}}}]),b}(Polymer.Element);window.customElements.define(AnimeImage.is,AnimeImage);</script></dom-module></body></html>